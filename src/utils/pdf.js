import { exec } from 'child_process'
import { join } from 'node:path'

const plyse = async (pdfpath) => {
  console.log(join(__dirname, '../../src/pdfscan/pdfscan.py'))
  console.log(pdfpath)
  console.log('output file path', join(__dirname, '../output/pdfout'))
  const command = `python3 ${join(__dirname, '../../src/pdfscan/pdfscan.py')} ${pdfpath} --output_json_path ${join(__dirname, '../../src/output/pdfout')}`
  return new Promise((resolve, reject) => {
    exec(command, (error, stdout, stderr) => {
      if (error) {
        console.error(`Error: ${error.message}`)
        reject(error.message)
        return
      }
      if (stderr) {
        console.error(`stderr: ${stderr}`)
        reject(stderr)
        return
      }
      resolve(stdout)
    })
  })
}

export default plyse
