const { parentPort } = require("worker_threads");
const { exec } = require("child_process");
const path = require("path");
const fs = require("fs").promises;

// Listening for messages from the main thread
parentPort.on("message", async (command_help) => {
  try {
    console.log(
      "Command ( Worker ):",
      `${command_help.split("^")[1]} extraction\n`
    );
    const { stdout, stderr } = exec(
      `python3 v3/vol.py -f ${command_help.split("^")[0]} -r json windows.${
        command_help.split("^")[1]
      }`
    );

    const outputFile = path.join(
      __dirname,
      "../../src/output",
      `${command_help.split("^")[1]}.json`
    );

    await fs.writeFile(outputFile, stdout);
  } catch (error) {
  } finally {
    parentPort.postMessage("done");
  }
});
