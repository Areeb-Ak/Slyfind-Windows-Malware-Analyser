const { parentPort } = require('worker_threads');
const { exec } = require('child_process');
const fs = require('fs').promises;


// Listening for messages from the main thread
parentPort.on('message', async (command_help) => {
  try {
    console.log('Command ( Worker ):', `${command_help.split('^')[1]} extraction\n`)
    
    const { stdout } = exec(
      `python3 ${command_help.split('^')[2]} -f ${command_help.split('^')[0]} -r json windows.${
        command_help.split('^')[1]
      }`
    )

    await fs.writeFile(command_help.split('^')[3], stdout)
  } catch (error) {
  } finally {
    parentPort.postMessage('done')
  }
})
