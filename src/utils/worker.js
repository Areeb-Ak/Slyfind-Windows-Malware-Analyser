const { parentPort } = require('worker_threads')
const { exec } = require('child_process')
const fs = require('fs').promises

// Listening for messages from the main thread
parentPort.on('message', async (command_help) => {
  try {
    console.log(`Worker (${command_help.split('^')[1]})`)
    const { stdout } = exec(
      `${command_help.split('^')[0]} ${command_help.split('^')[1]} ${command_help.split('^')[2]}`
    )
    await fs.writeFile(command_help.split('^')[3], stdout)
  } catch (error) {
  } finally {
    parentPort.postMessage('done')
  }
})
